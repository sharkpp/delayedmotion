{"version":3,"sources":["serviceWorker.js","misc/constants.js","views/UploadImage.js","views/SelectArea.js","views/DownloadImage.js","components/SimplePopup.js","components/PrivacyPolicy.js","App.js","index.js"],"names":["Boolean","window","location","hostname","match","ImageSourceType","Step","UploadImage","SelectArea","DownloadImage","onNextStep","useState","imageSrcType","setImageSrcType","imageUrl","setImageUrl","invalidImageUrl","setInvalidImageUrl","loadingImageUrl","setLoadingImageUrl","useDropzone","accept","onDrop","files","reader","FileReader","onload","image","Image","src","result","readAsDataURL","disabled","rejectedFiles","getRootProps","getInputProps","rejectedFilesItems","map","file","key","path","handleSelectImageUrl","useCallback","e","target","value","handleSelectedImageUrl","crossOrigin","err","onerror","Card","Header","Nav","variant","activeKey","onSelect","k","Item","Link","eventKey","Body","className","icon","faFileUpload","size","InputGroup","FormControl","placeholder","onChange","isInvalid","readOnly","Append","Button","onClick","Spinner","as","animation","role","aria-hidden","Form","Control","Feedback","type","createRef","canvasRef","canvasMaskRef","canvasOffscreenRef","crop","setCrop","useEffect","canvas","current","width","height","getContext","drawImage","canvasOffscreen","handleChangeArea","newCrop","Object","assign","Math","floor","ctx","scale","clientWidth","ctxOffscreen","xiMax","yiMax","canvasMask","ctxMask","fillStyle","fillRect","beginPath","ellipse","PI","fill","maskData","getImageData","data","xyStep","xOffset","x","yOffset","y","yi","xi","random","handleAreaLock","toBlob","imageBlob","cropValid","Text","Group","Alert","renderComponent","ref","style","onComplete","display","FileDownload","require","prevewImage","setPrevewImage","handleDownload","handleNext","Row","Col","left","top","open","caption","title","onClose","children","console","log","Title","MatchSection","split","line","lineIndex","test","Steps","App","step","setStep","setImage","image2","setImage2","showPrivacyPolicy","setShowPrivacyPolicy","handelUploadImageFinish","selectedImage","handelSelectAreaFinish","generatedImage","handelDownloadImageFinish","steps","activeStep","faUserShield","href","faTwitter","faBug","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.4101ddd0.chunk.js","sourcesContent":["\"use struct\";\n\n// このオプションのコードは、Service Workerを登録するために使用されます。\n// register() はデフォルトでは呼び出されません。\n\n// これにより、その後の実稼働時のアクセスでアプリの読み込みが速くなり、\n// オフライン機能が提供されます。 ただし、開発者（およびユーザー）は、\n// 以前にキャッシュされたリソースがバックグラウンドで更新されるため、\n// ページで開いている既存のタブがすべて閉じられた後、ページへの以降の\n// アクセスでのみ展開された更新が表示されます。\n\n// このモデルの利点とオプトイン方法の詳細については、\n// https://bit.ly/CRA-PWA をご覧ください。\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] は IPv6 localhost アドレスです。\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 は IPv4 のローカルホストと見なされます。\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // URLコンストラクターは、SWをサポートするすべてのブラウザーで使用できます。\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // PUBLIC_URL がページの配信元と異なる発信元にある場合サービスワーカーは機能しません。\n      // これは、アセットの提供にCDNが使用されている場合に発生する可能性があります。\n      // https://github.com/facebook/create-react-app/issues/2374 を参照してください\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // これはローカルホストで実行されています。 Service Workerがまだ存在するかどうかを確認しましょう。\n        checkValidServiceWorker(swUrl, config);\n\n        // いくつかの追加のログを localhost に追加し、開発者に\n        // service worker/PWA ドキュメントを参照させます。\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // ローカルホストではありません。サービスワーカーを登録するだけです。\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // この時点で更新された事前キャッシュされたコンテンツが取得されましたが、\n              // 以前のサービスワーカーは、すべてのクライアントタブが閉じられるまで\n              // 古いコンテンツを引き続き提供します。\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // コールバックを実行\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // この時点ですべてが事前にキャッシュされています。\n              // \"コンテンツはオフラインで使用するためにキャッシュされます。\"\n              // メッセージを表示するのに最適なタイミングです。\n              console.log('Content is cached for offline use.');\n\n              // コールバックを実行\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // ページをリロードできない場合、サービスワーカーが見つかるかどうかを確認します。\n  fetch(swUrl)\n    .then(response => {\n      // Service Worker が存在し、JSファイルを実際に取得していることを確認してください。\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // サービスワーカーが見つかりません。おそらく別のアプリ。ページをリロード。\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // サービスワーカーが見つかりました。通常どおり続行。\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","\"use struct\";\n\n// 画像の元の場所\nexport const ImageSourceType = {\n  FromLocal: 0,\n  FromUrl:   1,\n};\n\n// 処理のステップの状態\nexport const Step = {\n  UploadImage:   0,\n  SelectArea:    1,\n  DownloadImage: 2,\n};\n","\"use struct\";\n\nimport React, { useState, useCallback } from 'react';\n\nimport { Nav, Card, Form, FormControl, InputGroup, Button, Spinner } from 'react-bootstrap';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faFileUpload } from '@fortawesome/free-solid-svg-icons'\n\nimport {useDropzone} from 'react-dropzone'\nimport 'react-dropzone/examples/theme.css';\n\nimport { ImageSourceType } from '../misc/constants';\n\nimport './UploadImage.css';\n\nexport default function ({ onNextStep }) {\n\n  const [ imageSrcType, setImageSrcType ] = useState(ImageSourceType.FromLocal);\n  const [ imageUrl, setImageUrl ] = useState('');\n  const [ invalidImageUrl, setInvalidImageUrl ] = useState(false);\n  const [ loadingImageUrl, setLoadingImageUrl ] = useState(false);\n\n  const handleDrop = (files) => {\n    if (files[0]) {\n      const reader = new FileReader();\n      reader.onload = () => {\n        const image = new Image();\n        image.src = reader.result;\n        image.onload = () => {\n          onNextStep(image);\n        }\n      }\n      reader.readAsDataURL(files[0]);\n    }\n  };\n\n  const {\n    rejectedFiles,\n    getRootProps,\n    getInputProps\n  } = useDropzone({\n    accept: 'image/jpeg, image/png',\n    onDrop: handleDrop,\n    disabled: loadingImageUrl,\n  });\n\n  const rejectedFilesItems = rejectedFiles.map(file => (\n    <li key={file.path}>\n      {file.path} は利用できません。\n    </li>\n  ));\n\n  const handleSelectImageUrl = useCallback((e) => {\n    setInvalidImageUrl(false);\n    setImageUrl(e.target.value);\n  });\n  const handleSelectedImageUrl = useCallback(() => {\n    setLoadingImageUrl(true);\n    setInvalidImageUrl(false);\n    const image = new Image();\n    image.crossOrigin = \"anonymous\";\n    image.src = 'https://api-gw98.herokuapp.com/' + imageUrl;\n    image.onload = (err) => {\n      setLoadingImageUrl(false);\n      onNextStep(image);\n    }\n    image.onerror = (err) => {\n      setLoadingImageUrl(false);\n      setInvalidImageUrl(true);\n    }\n  });\n\n  return (\n    <>\n      <Card.Header>\n        <Nav variant=\"tabs\" activeKey={imageSrcType} onSelect={k => setImageSrcType(k)}>\n          <Nav.Item>\n            <Nav.Link eventKey={ImageSourceType.FromLocal}>アップロード</Nav.Link>\n          </Nav.Item>\n          <Nav.Item>\n            <Nav.Link eventKey={ImageSourceType.FromUrl}>URLを指定</Nav.Link>\n          </Nav.Item>\n        </Nav>\n      </Card.Header>\n\n      {ImageSourceType.FromLocal == imageSrcType && <Card.Body>\n        <div {...getRootProps({className: 'dropzone'+(loadingImageUrl?' disabled':'')})}>\n          <input {...getInputProps()} />\n          <FontAwesomeIcon icon={faFileUpload} size=\"4x\" />\n          <p>画像をここにドロップするか、クリックして選択してください</p>\n          <em>jpeg もしくは png のみ指定可能)</em>\n        </div>\n        <ol>\n          {rejectedFilesItems}\n        </ol>\n      </Card.Body>}\n\n      {ImageSourceType.FromUrl == imageSrcType && <Card.Body>\n        <InputGroup className=\"mb-3\">\n          <FormControl\n            placeholder=\"画像のURL\"\n            value={imageUrl}\n            onChange={handleSelectImageUrl}\n            isInvalid={invalidImageUrl}\n            readOnly={loadingImageUrl}\n          />\n          <InputGroup.Append>\n            <Button \n              variant=\"outline-primary\"\n              onClick={handleSelectedImageUrl}\n              disabled={!imageUrl || loadingImageUrl}\n            >\n              {loadingImageUrl && <Spinner\n                as=\"span\"\n                animation=\"border\"\n                size=\"sm\"\n                role=\"status\"\n                aria-hidden=\"true\"\n                className=\"btn-inner-spinner\"\n              />}\n              画像を選択\n            </Button>\n          </InputGroup.Append>\n          <Form.Control.Feedback type=\"invalid\">\n            指定したURLは画像として利用できませんでした\n          </Form.Control.Feedback>\n        </InputGroup>\n      </Card.Body>}\n    </>\n  );\n}\n","\"use struct\";\n\nimport React, { useState, useEffect, useCallback, createRef } from 'react';\nimport { Button, Card, Form, Alert } from 'react-bootstrap';\nimport ReactCrop from 'react-image-crop';\nimport 'react-image-crop/dist/ReactCrop.css';\nimport './SelectArea.css';\n\nconst BlockSize = 5;\n\nexport default function ({ onNextStep, image }) {\n\n  const [ canvasRef, setCanvasRef ] = useState(createRef());\n  const [ canvasMaskRef, setCanvasMaskRef ] = useState(createRef());\n  const [ canvasOffscreenRef, setCanvasOffscreenRef ] = useState(createRef());\n  const [crop, setCrop] = useState({ });\n\n  useEffect(() => {\n\n    // 画像を描画\n    const canvas = canvasRef.current;\n    canvas.width = image.width;\n    canvas.height= image.height;\n    const ctx    = canvas.getContext('2d');\n    ctx.drawImage(image, 0, 0, image.width, image.height);\n\n    const canvasOffscreen = canvasOffscreenRef.current;\n    canvasOffscreen.width = image.width;\n    canvasOffscreen.height= image.height;\n\n  }, [image]);\n\n  // 範囲変更\n  const handleChangeArea = useCallback(() => {\n    const newCrop = Object.assign({}, crop, {\n      // 領域を丸める\n      width:  Math.floor(crop.width  / BlockSize) * BlockSize + 1,\n      height: Math.floor(crop.height / BlockSize) * BlockSize + 1,\n    });\n\n    const canvas = canvasRef.current;\n    const ctx    = canvas.getContext('2d');\n    const scale  = image.width / canvas.clientWidth;\n\n    const canvasOffscreen = canvasOffscreenRef.current;\n    const ctxOffscreen    = canvasOffscreen.getContext('2d');\n    ctxOffscreen.drawImage(image, 0, 0, image.width, image.height);\n\n    const xiMax = Math.floor(newCrop.width  / BlockSize);\n    const yiMax = Math.floor(newCrop.height / BlockSize);\n    const canvasMask = canvasMaskRef.current;\n    canvasMask.width = xiMax;\n    canvasMask.height= yiMax;\n    const ctxMask    = canvasMask.getContext('2d');\n\n    if (canvasMask.width < 1 || canvasMask.height < 1) {\n      ctx.drawImage(canvasOffscreen, 0, 0);\n      return;\n    }\n\n    ctxMask.fillStyle = '#000000';\n    ctxMask.fillRect(0, 0, canvasMask.width, canvasMask.height);\n    ctxMask.fillStyle = '#FF0000';\n    ctxMask.beginPath();\n    ctxMask.ellipse(canvasMask.width / 2, canvasMask.height / 2, canvasMask.width / 2 * 0.9, canvasMask.height / 2 * 0.9, 0, 0, 2 * Math.PI);\n    ctxMask.fill();\n    const maskData = ctxMask.getImageData(0, 0, canvasMask.width, canvasMask.height).data; // [ R(0,0), G(0,0), B(0,0), alpha(0,0), ... ]\n\n    const xyStep  = 5 * scale;\n    const xOffset = newCrop.x * scale;\n    const xMax    = xOffset + newCrop.width * scale;\n    const yOffset = newCrop.y * scale;\n    const yMax    = yOffset + newCrop.height * scale;\n\n    ctxOffscreen.fillStyle = 'rgb(0,0,0,0.5)';\n    ctxOffscreen.fillRect(newCrop.x * scale, newCrop.y * scale,\n                          Math.floor((newCrop.width  + 1) / BlockSize) * xyStep,\n                          Math.floor((newCrop.height + 1) / BlockSize) * xyStep);\n\n    for (let y = yOffset, yi = 0; yi < yiMax; y += xyStep, ++yi) {\n      for (let x = xOffset, xi = 0; xi < xiMax; x += xyStep, ++xi) {\n        if (0 == maskData[(xi + yi * xiMax) * 4 + 0] && Math.random() < 0.3) {\n          ctxOffscreen.fillStyle = '#FFFFFF';\n          ctxOffscreen.fillRect(x, y, xyStep + scale, xyStep + scale);\n        }\n      }\n    }\n\n    ctx.drawImage(canvasOffscreen, 0, 0);\n\n    setCrop(newCrop);\n  }, [canvasRef, canvasOffscreenRef, canvasMaskRef, crop]);\n\n  // 範囲確定\n  const handleAreaLock = useCallback(() => {\n    const canvas = canvasRef.current;\n    canvas.toBlob((imageBlob) => {\n      onNextStep(imageBlob);\n    }, 'image/jpeg', 0.9);\n  }, [image, crop]);\n  \n  const cropValid = crop.width && crop.height;\n\n  return (\n    <Card.Body>\n      <Card.Text>\n        <Form.Group>\n          {!!cropValid&&<Button onClick={handleAreaLock} >\n            選択完了\n          </Button>}\n          {!cropValid&&<Alert variant='info'>\n            揺らす範囲を選択してください\n          </Alert>}\n        </Form.Group>\n        <ReactCrop\n          renderComponent={\n            <canvas ref={canvasRef} style={{ width: '100%' }} />\n          }\n          crop={crop}\n          onChange={newCrop => setCrop(newCrop)}\n          onComplete={() => handleChangeArea()}\n        />\n      </Card.Text>\n      <canvas ref={canvasOffscreenRef} style={{ width: '100%', display: 'none' }} />\n      <canvas ref={canvasMaskRef} style={{ display: 'none' }} />\n    </Card.Body>\n  );\n}\n","\"use struct\";\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { Button, Card, Form, Col } from 'react-bootstrap';\nimport './DownloadImage.css';\nconst FileDownload = require('js-file-download');\n\nexport default function ({ image, onNextStep }) {\n\n  const [ prevewImage, setPrevewImage ] = useState('');\n\n  useEffect(() => {\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      setPrevewImage(e.target.result);\n    };\n    reader.readAsDataURL(image);\n  }, [image]);\n\n  const handleDownload = useCallback(() => {\n    FileDownload(image, 'sample.jpg', 'image/jpeg');\n  }, [image]);\n\n  const handleNext = useCallback(() => {\n    onNextStep();\n  }, [onNextStep]);\n\n  return (\n    <Card.Body>\n      <Form.Row>\n        <Form.Group as={Col}>\n          <Button onClick={handleDownload} >\n            ダウンロード\n          </Button>\n        </Form.Group>\n        <Form.Group as={Col}>\n          <Button variant=\"secondary\" onClick={handleNext} >\n            新規作成\n          </Button>\n        </Form.Group>\n      </Form.Row>\n      <div className=\"image-preview\">\n        <img src={prevewImage} className=\"layout\" />\n        <img src={prevewImage} className=\"main\" style={{ left: 0, top: 0 }} />\n      </div>\n    </Card.Body>\n  );\n}\n","\"use struct\";\n\nimport React, { useState, useCallback } from 'react';\n\nimport { Card, Button } from 'react-bootstrap';\n\nimport './SimplePopup.css';\n\nexport default function ({ open, caption, title, onClose, children }) {\nconsole.log('open',open);\n  return (\n    <div className={`simple-popup ${open?'open':'close'}`} >\n      <div className='background' />\n      <div>\n        <Card>\n          {!!caption&&<Card.Header>{caption}</Card.Header>}\n          <Card.Body>\n            {!!title&&<Card.Title>{title}</Card.Title>}\n            <Card.Text style={{\n                  'height': `calc(100% - 1rem${!!title?' - 2rem':''} - 2.5rem)`\n            }}>\n              {children}\n            </Card.Text>\n            <Button variant=\"primary\" onClick={() => {onClose&&onClose()}}>閉じる</Button>\n          </Card.Body>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","\"use struct\";\n\nimport React, { useState, useCallback } from 'react';\n\nimport './PrivacyPolicy.css';\n\nconst PrivacyPolicyText = `\n１．基本的考え方\n揺れる※※画像ジェネレータ（以下「当サイト」という。）において、提供するサービス（当サイトによる情報提供、各種意見の受付等）の円滑な運営に必要な範囲で、当サイトを利用される皆様の情報を収集しています。収集した情報は利用目的の範囲内で適切に取り扱います。\n\n２．収集する情報の範囲\n（１） 当サイトでは、インターネットドメイン名、ＩＰアドレス、当サイトの閲覧等の情報（以下「利用者の情報」という。）を自動的に収集します。なお、クッキー（サーバ側で利用者を識別するために、サーバから利用者のブラウザに送信され、利用者のコンピュータに蓄積される情報）は、ユーザビリティーの向上を目的とする内容に限定するものであり、個人情報は一切含みません。また、利用者のブラウザの設定によりクッキーの機能を無効にすることもできます。\n\n３．利用目的\n（１） ２．（１）において収集した情報は、当サイトが提供するサービスを円滑に運営するための参考として利用します。\n\n（２） 当サイトでは、サイトの利用状況を把握するために[Google Analytics](https://developers.google.com/analytics/?hl=ja)を利用しています。Google Analytics は、クッキーを利用して利用者の情報を収集します。[Google Analytics 利用規約は、こちら](https://www.google.com/analytics/terms/jp.html)をご覧ください。\n\n４．利用及び提供の制限\n当サイトでは、法令に基づく開示請求があった場合、不正アクセス、脅迫等の違法行為があった場合その他特別の理由のある場合を除き、収集した情報を「３．利用目的」以外の目的のために自ら利用し、又は第三者に提供いたしません。ただし、統計的に処理された当サイトのアクセス情報、利用者属性等の情報については公表することがあります。\n\n５．安全確保の措置\n（１） 当サイトは、収集した情報の漏えい、滅失又はき損の防止その他収集した情報の適切な管理のために必要な措置を講じます。 \n\n（２） Google Analyticsにより収集された利用者の情報は、Google社のプライバシーポリシーに基づいて管理されます。[Google社のプライバシーポリシーは、こちら](http://www.google.com/intl/ja/policies/privacy/)をご覧下さい。なお、Google Analyticsのサービス利用による損害については、[@sharkpp](https://twitter.com/sharkpp)は責任を負わないものとします。\n\n６．自己に関する情報の開示\n当サイトにおいては、氏名、生年月日その他一般的に個人を識別できる情報を収集しておりません。\n\n７．適用範囲\n本方針は、当サイトにおいてのみ適用され、当サイトにリンクされています外部サイトについては適用されません。\n\n８．その他\n@sharkpp では、本方針を改定することがあります。改定する場合は、当サイトでお知らせします。\n\n当サイトの利用に関する落ちお合わせは、[@sharkpp](https://twitter.com/sharkpp) までお願いします。\n`;\n\n//const MatchLink = /\\[.+?\\]\\(.+?\\)/;\nconst MatchSection = /^[０-９]/;\n\nexport default function ({}) {\n\n  return (\n    <div className=\"privacy-policy\">\n{\n  PrivacyPolicyText.split(\"\\n\").map((line, lineIndex) => {\n    return (MatchSection.test(line)\n        ? <h2 key={`L${lineIndex}`}>{line}</h2>\n        : <p key={`L${lineIndex}`}>{line}</p>\n      );\n  })\n}\n    </div>\n  );\n}\n","\"use struct\";\n\nimport React, { useState, useCallback } from 'react';\n\nimport './App.css';\n\nimport { Card, Button } from 'react-bootstrap'\n\nimport Stepper from 'react-stepper-horizontal';\n\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faBug, faUserShield } from '@fortawesome/free-solid-svg-icons'\nimport { faTwitter } from '@fortawesome/free-brands-svg-icons'\n\nimport UploadImageView from './views/UploadImage';\nimport SelectAreaView from './views/SelectArea';\nimport DownloadImageView from './views/DownloadImage';\n\nimport SimplePopup from './components/SimplePopup';\nimport PrivacyPolicy from './components/PrivacyPolicy';\n\nimport { Step } from './misc/constants';\n\nconst Steps = [\n  { title: '画像をアップロード' },\n  { title: '揺らす範囲を設定' },\n  { title: '完成'}\n];\n\nfunction App() {\n\n  const [ step,  setStep  ] = useState(Step.UploadImage);\n  const [ image, setImage ] = useState(null);\n  const [ image2, setImage2 ] = useState(null);\n  const [ showPrivacyPolicy, setShowPrivacyPolicy ] = useState(false);\n\n  const handelUploadImageFinish = useCallback((selectedImage) => {\n    setImage(selectedImage);\n    setStep(Step.SelectArea);\n  });\n\n  const handelSelectAreaFinish = useCallback((generatedImage) => {\n    setImage2(generatedImage);\n    setStep(Step.DownloadImage);\n  });\n\n  const handelDownloadImageFinish = useCallback(() => {\n    setStep(Step.UploadImage);\n  });\n\n  return (\n    <div className=\"App\">\n      <h1>\n        揺れる<ruby>\n          ※<rp>(</rp><rt>ちょめ</rt><rp>)</rp>\n          ※<rp>(</rp><rt>ちょめ</rt><rp>)</rp>\n        </ruby>画像ジェネレータ\n      </h1>\n      <div className=\"stepper\">\n        <Stepper steps={Steps} activeStep={step} />\n      </div>\n      <Card>\n        {[\n          <UploadImageView   onNextStep={handelUploadImageFinish} />,\n          <SelectAreaView    onNextStep={handelSelectAreaFinish}    image={image} />,\n          <DownloadImageView onNextStep={handelDownloadImageFinish} image={image2} />\n        ][step]}\n      </Card>\n      <div className=\"footer\">\n          <Button variant=\"link\" size=\"sm\" onClick={() => setShowPrivacyPolicy(true)}>\n            <FontAwesomeIcon icon={faUserShield} /> プライバシーポリシー\n          </Button>\n          <Button variant=\"link\" size=\"sm\" target=\"_blank\" href=\"https://twitter.com/sharkpp\">\n            <FontAwesomeIcon icon={faTwitter} /> @sharkpp\n          </Button>\n          <Button variant=\"link\" size=\"sm\" target=\"_blank\" href=\"https://github.com/sharkpp/delayedmotion/issues/new\">\n            <FontAwesomeIcon icon={faBug} /> 不具合報告\n          </Button>\n      </div>\n      <SimplePopup\n        open={showPrivacyPolicy}\n        onClose={() => setShowPrivacyPolicy(false)}\n        title=\"プライバシーポリシー\"\n      >\n        <PrivacyPolicy />\n      </SimplePopup>\n    </div>\n  );\n}\n\nexport default App;\n","\"use struct\";\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport * as serviceWorker from './serviceWorker';\n\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport './index.css';\n\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// アプリをオフラインで動作させてより速くロードしたい場合は、以下で unregister() を\n// register() に変更できます。これにはいくつかの落とし穴があります。\n// サービスワーカーの詳細: https://bit.ly/CRA-PWA\n\nserviceWorker.unregister();\n\n// 要求スペック\n//   config#onUpdate(registration);\n//   config#onSuccess(registration);\n// serviceWorker.register(config);\n"],"sourceRoot":""}